apiVersion: v1
kind: ConfigMap
metadata:
  name: livekit-config
data:
  livekit.yaml: |
    log_level: info
    port: 7880
    rtc:
      tcp_port: 7881
      port_range_start: 50000
      port_range_end: 50100
      use_external_ip: true
    keys:
      hulyapi: JO65B1cRsWazZU6wI4awDtoxbpjcJp41
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: livekit
spec:
  replicas: 1
  selector:
    matchLabels:
      app: livekit
  template:
    metadata:
      labels:
        app: livekit
    spec:
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
      containers:
        - name: livekit
          image: livekit/livekit-server:v1.9.11
          args: ["--config", "/etc/livekit/livekit.yaml"]
          ports:
            - containerPort: 7880
              protocol: TCP
            - containerPort: 7881
              protocol: TCP
          volumeMounts:
            - name: config
              mountPath: /etc/livekit
      volumes:
        - name: config
          configMap:
            name: livekit-config
---
apiVersion: v1
kind: Service
metadata:
  name: huly-livekit
spec:
  selector:
    app: livekit
  ports:
    - name: signal
      port: 7880
      targetPort: 7880
